flashinfer_commit := v0.1.5

build-flashinfer:
	git clone https://github.com/flashinfer-ai/flashinfer.git flashinfer && \
	cd flashinfer && git fetch && git checkout $(flashinfer_commit)  && \
	git submodule update --init --recursive && \
	cd python/ && \
	CUDA_ARCH_LIST="8.0;9.0a" NVCC_GENCODE="-gencode=arch=compute_80,code=sm_80 -gencode=arch=compute_90a,code=sm_90a" TORCH_CUDA_ARCH_LIST="8.0;9.0a" python setup.py build

install-flashinfer: build-flashinfer
	cd flashinfer/python/ &&  \
	CUDA_ARCH_LIST="8.0;9.0a" NVCC_GENCODE="-gencode=arch=compute_80,code=sm_80 -gencode=arch=compute_90a,code=sm_90a" TORCH_CUDA_ARCH_LIST="8.0;9.0a" python setup.py install
